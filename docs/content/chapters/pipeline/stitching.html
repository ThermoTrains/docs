<h3>Stitching</h3>

<ul>
  <li><b>In:</b> Recktifizierte Zug Frames</li>
  <li><b>Out:</b> Zug Panorama</li>
</ul>

<p>
  Dadurch was wir vorher alles bereits mit den Frames unternommen haben können wir nun ein vereinfachtes Stitching
  Verfahren anwenden. Wir haben zuerst mit handelsüblichem Panoramastitching probiert Resultate herauszuholen,
  schlugen aber fehl. Die Stitcher Klasse von OpenCV ist zum einen nicht in der Java Wrapper Library verfügbar,
  weshalb wir selber einen JNI Wrapper schreiben mussten. Dieser hat es schlussendlich nicht überlebt. Die Stitcher
  Funktionalität von OpenCV bietet zwei Modi an: Landschaftspanorama und Ebenenpanorama. Der
  Landschaftspanorama-Modus geht davon aus, dass die Kamera geschwenkt wurde bei der Aufnahme der verschiedenen
  Bilder. Der Ebenenpanoram-Modus geht davon aus man hat eine Karte oder Dokumente fotografiert welche man in einer
  Ebene zusammenfügen möchte.
</p>

<p>
  Das Hauptproblem besteht darin, dass wir jeweils grosse Überlappungen zwischen den einzelnen Frames gibt. Hinzu
  kommt, dass sich Wagons ziemlich ähnlich sind. Der erste Versuch war einfach mal drauf los hauen. Wir haben
  sämtliche Frames der Stitcher Klasse übergeben, den Modus auf Ebene gestellt und geschaut was passiert. Es gab
  einen Fehler den wir auf keine Weise beheben konnten. Der Modus Landschaft hat alle ein sehr amüsantes Resultat
  geliefert, das allerdings weniger hilfreich war. Die Wagons waren wild übereinander gestapelt und verzerrt.
</p>

<p>
  Der zweite Ansatz war die Bilder gestaffelt zu stitchen. Das heisst wir würden inkrementell ein Bild mit dem
  bisherigen Fortschritt zusammenstitchen. Das war auch nicht erfolgreich. Man kann auch nicht spezifizeren wo das
  nächste Bild hinsoll. Also hat OpenCV versucht das Bild irgendwo zu platzieren. Meistens gab es auch hier einen
  Fehler weil zu wenig Bilder vorhanden waren.
</p>

<p>
  Danach haben wir versucht das Stitching selber zu implementieren mit der OpenCV Methode
  <code>findHomography(...)</code>. Dazu mussten wir Featurepunkte in den beiden Bildern finden die wir
  zusammenstitchen wollten. Aus Gründen die wir nicht sehr genau untersucht haben hat das aber auch nicht geklappt.
  Wahrscheinlich war die Qualität der Featurepunkte ungenügend.
</p>

<h4>Pattern Matching</h4>

<p>
  Das Verfahren das uns das die Augen geöffnet hat und einwandfrei funktioniert ist verblüffend simpel. Wir finden in
  zwei aufeinanderfolgenden Frames ein Teilausschnitt von Frame A in Frame B. Wenn wir es gefunden haben, haben wir
  eine X-Koordinate und dort können wir die Bilder zusammenfügen.
</p>

<figure class="affix">
  <img src="images/pipeline/stitch/template.jpg">
  <figcaption>Template</figcaption>
</figure>
<figure class="affix">
  <img src="images/pipeline/stitch/match.jpg">
  <figcaption>Gefundenes Template</figcaption>
</figure>

<p>
  Fügen wir alle Zugframes zusammen erhalten wir so das gewünschte Resultat.
</p>

<figure class="affix">
  <img src="images/pano.jpg">
  <figcaption>Zug Panorama</figcaption>
</figure>
